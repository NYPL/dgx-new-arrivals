import React from 'react';

const audioHeadphones = (<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
  <title>audio.icon</title>
  <g>
    <path d="M7.50842,19.29355A0.94557,0.94557,0,0,1,6.56284,18.348V15.376a9.47232,9.47232,0,0,1,18.94464,0v2.91654a0.94558,0.94558,0,0,1-1.89117,0V15.376a7.58115,7.58115,0,0,0-15.16231,0v2.972A0.94557,0.94557,0,0,1,7.50842,19.29355Z" />
    <g>
      <path d="M21.82651,23.66863a0.94557,0.94557,0,0,1-.94558-0.94558V16.22111a0.94558,0.94558,0,0,1,1.89117,0V22.723A0.94557,0.94557,0,0,1,21.82651,23.66863Z" />
      <path d="M10.24381,23.75a0.94557,0.94557,0,0,1-.94558-0.94558V16.22111a0.94558,0.94558,0,1,1,1.89117,0v6.58331A0.94557,0.94557,0,0,1,10.24381,23.75Z" />
    </g>
  </g>
</svg>);
const mediaBluRay = (<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
  <title>blue.ray.icon</title>
  <path d="M12.25,16a3.738,3.738,0,0,0,1.09839,2.65161l5.30328-5.30328A3.75,3.75,0,0,0,12.25,16Z" fill="none" />
  <path d="M16,19.75a3.75,3.75,0,0,0,2.65167-6.40167l-5.30328,5.30328A3.738,3.738,0,0,0,16,19.75Z" />
  <path d="M24.4411,7.5589A11.93752,11.93752,0,1,0,27.9375,16,11.90013,11.90013,0,0,0,24.4411,7.5589ZM12.25,16a3.75013,3.75013,0,1,1,1.09839,2.65161A3.75,3.75,0,0,1,12.25,16ZM16,26.9375a10.85556,10.85556,0,0,1-6.99524-2.52808l4.41772-4.41772a4.75228,4.75228,0,0,0,6.56927-6.56927l4.41766-4.41766A10.9387,10.9387,0,0,1,16,26.9375Z" />
</svg>);
const audioDisc = (<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
  <title>audio.disc.icon</title>
  <path d="M16,4.0625A11.9375,11.9375,0,1,0,27.9375,16,11.9375,11.9375,0,0,0,16,4.0625ZM16,19.75A3.75,3.75,0,1,1,19.75,16,3.75,3.75,0,0,1,16,19.75Z" />
</svg>);
const dvdDisc = (<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
  <title>dvd.icon.svg</title>
  <circle cx="16" cy="16" r="3.75" fill="none" />
  <path d="M16,10.625A5.375,5.375,0,1,0,21.375,16,5.381,5.381,0,0,0,16,10.625Zm0,9.125A3.75,3.75,0,1,1,19.75,16,3.75,3.75,0,0,1,16,19.75Z" />
  <path d="M16,4.0625A11.9375,11.9375,0,1,0,27.9375,16,11.9375,11.9375,0,0,0,16,4.0625Zm0,19.65625A7.71875,7.71875,0,1,1,23.71875,16,7.72719,7.72719,0,0,1,16,23.71875Z" />
</svg>);
const book = (<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
  <title>book.icon</title>
  <g>
    <path d="M26.09478,8.31652A13.1617,13.1617,0,0,0,15.97189,8.1603a13.079,13.079,0,0,0-10.09165.18746,0.88881,0.88881,0,0,0-.46865.84357V21.81371a0.89164,0.89164,0,0,0,.37492.81233,0.93487,0.93487,0,0,0,.90606.06249,11.44018,11.44018,0,0,1,8.9044,0c0.03124,0,.03124,0,0.03124.03124a0.06237,0.06237,0,0,1,.06249.03124,0.70873,0.70873,0,0,0,.125.03124h0.18746a0.5317,0.5317,0,0,0,.2187-0.03124,0.06237,0.06237,0,0,0,.06249-0.03124,0.70873,0.70873,0,0,1,.125-0.03124,11.464,11.464,0,0,1,8.9044,0,0.86486,0.86486,0,0,0,.40617.09373A1.05326,1.05326,0,0,0,26.251,22.626a0.94244,0.94244,0,0,0,.43741-0.81233V9.19133A1.04849,1.04849,0,0,0,26.09478,8.31652ZM24.78256,20.439a13.30172,13.30172,0,0,0-8.74818.34368A13.26349,13.26349,0,0,0,7.2862,20.439V9.8162a11.30538,11.30538,0,0,1,8.342.2187c0.03124,0,.03124,0,0.03124.03124a0.06237,0.06237,0,0,1,.06249.03124,0.70872,0.70872,0,0,0,.125.03124h0.34368a0.11478,0.11478,0,0,0,.09373-0.03124c0.03125,0,.06249-0.03124.09373-0.03124,0,0,.06249,0,0.06249-0.03124a11.51979,11.51979,0,0,1,8.37326-.2187V20.439H24.78256Z" />
    <path d="M16.00313,17.81454a0.76028,0.76028,0,0,1-.74984-0.74984V13.378a0.74984,0.74984,0,0,1,1.49969,0V17.0647A0.74014,0.74014,0,0,1,16.00313,17.81454Z" />
  </g>
</svg>);
const largePrint = (<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
  <title>largePrint.icon-01</title>
  <path d="M7.132,6.0411H24.97514l0.16949,5.36219h-0.755a6.43678,6.43678,0,0,0-1.40988-3.28973q-0.85518-.76272-3.5979-0.76272H17.62525V23.499q0,1.824.57012,2.25992a5.26381,5.26381,0,0,0,2.49619.57525v0.58553H11.49263V26.3342a4.36809,4.36809,0,0,0,2.49619-.66,4.1201,4.1201,0,0,0,.49307-2.545V7.35083h-1.772a6.022,6.022,0,0,0-3.56709.755,5.57976,5.57976,0,0,0-1.42529,3.29744H6.9471Z" />
</svg>);
const ereader = (<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
  <title>icon.eReader</title>
  <g>
    <path d="M23.09932,5.58011H8.962A1.59864,1.59864,0,0,0,7.33333,7.14367V24.92925A1.58533,1.58533,0,0,0,8.8969,26.49281H23.0993a1.54334,1.54334,0,0,0,1.56356-1.56356V7.14367a1.50537,1.50537,0,0,0-1.56354-1.56356h0ZM15.99812,25.5156a0.97927,0.97927,0,1,1,1.04238-.97723,1.01668,1.01668,0,0,1-1.04238.97723h0Zm7.1012-2.60595H8.962V7.14367H23.09932v15.766h0Z" />
    <g>
      <path d="M20.61338,9.99038h-9.186a0.456,0.456,0,0,1,0-.9121h9.12081a0.44532,0.44532,0,0,1,.456.456,0.43566,0.43566,0,0,1-.3909.456h0Z" />
      <path d="M20.61338,12.85692h-9.186a0.456,0.456,0,0,1,0-.9121h9.12081a0.44532,0.44532,0,0,1,.456.456,0.43071,0.43071,0,0,1-.3909.456h0Z" />
      <path d="M20.61338,15.59317h-9.186a0.456,0.456,0,0,1,0-.9121h9.12081a0.44532,0.44532,0,0,1,.456.456,0.43566,0.43566,0,0,1-.3909.456h0Z" />
      <path d="M20.61338,18.32942h-9.186a0.456,0.456,0,0,1,0-.9121h9.12081a0.44532,0.44532,0,0,1,.456.456,0.43566,0.43566,0,0,1-.3909.456h0Z" />
      <path d="M20.61338,21.13081h-9.186a0.456,0.456,0,0,1,0-.9121h9.12081a0.44532,0.44532,0,0,1,.456.456,0.43566,0.43566,0,0,1-.3909.456h0Z" />
    </g>
  </g>
</svg>);

const Overlay = ({ imgClass, name, author, icon, format, genre }) => (
  <div className={`itemOverlay ${imgClass}`}>
    <h3>{name}</h3>
    <div className="details">
      <p className="author">{author}</p>
      <p className="format">{icon}{format}</p>
      <p className="genre">{genre}</p>
    </div>
  </div>
);

Overlay.propTypes = {
  imgClass: React.PropTypes.string,
  name: React.PropTypes.string,
  author: React.PropTypes.string,
  icon: React.PropTypes.object,
  format: React.PropTypes.string,
  genre: React.PropTypes.string,
};

class BookCover extends React.Component {
  constructor(props) {
    super(props);

    this.state = {
      imageSrc: this.props.imgSrc,
      // The original width of the source image
      naturalWidth: 150,
      errorStatus: '',
    };

    this.handleLoadedImage = this.handleLoadedImage.bind(this);
    this.handleLoadedImageError = this.handleLoadedImageError.bind(this);
  }

  shouldComponentUpdate(nextProps) {
    if (this.state.name !== nextProps.name &&
      this.state.imageSrc !== nextProps.imgSrc) {
      this.setState({
        imageSrc: nextProps.imgSrc,
        errorStatus: '',
      });
      return true;
    }

    if (!nextProps.imgSrc || this.state.name !== nextProps.name) {
      return true;
    }

    return false;
  }

  handleLoadedImage() {
    const width = this.refs.coverImage.naturalWidth;

    if (width < 10 && width >= 0) {
      this.setState({
        errorStatus: 'one-pixel',
      });
    } else {
      this.setState({
        errorStatus: '',
      });
    }

    this.forceUpdate();
  }

  handleLoadedImageError() {
    this.setState({
      errorStatus: 'one-pixel',
      imageSrc: '',
    });
    this.forceUpdate();
  }

  render() {
    const imgClass = this.state.errorStatus === 'one-pixel' || (!this.state.imageSrc) ?
      'noImage' : '';
    let icon;
    let format;
    let item;

    switch (this.props.format) {
      case 'BOOK/TEXT':
        icon = book;
        format = 'Book';
        break;
      case 'AUDIOBOOK':
        icon = audioHeadphones;
        format = 'Audiobook';
        break;
      case 'BLU-RAY':
        icon = mediaBluRay;
        format = 'Blu-ray';
        break;
      case 'DVD':
        icon = dvdDisc;
        format = 'DVD';
        break;
      case 'E-AUDIOBOOK':
        icon = audioHeadphones;
        format = 'E-Audiobook';
        break;
      case 'E-BOOK':
        icon = ereader;
        format = 'E-Book';
        break;
      case 'LARGE PRINT':
        icon = largePrint;
        format = 'Large Print';
        break;
      case 'MUSIC CD':
        icon = audioDisc;
        format = 'Music CD';
        break;
      default:
        icon = book;
        format = this.props.format;
        break;
    }

    if (imgClass !== 'noImage') {
      item = (<img
        onLoad={this.handleLoadedImage}
        onError={this.handleLoadedImageError}
        id={`cover-${this.props.id}`}
        className={this.state.errorStatus}
        ref="coverImage"
        src={this.state.imageSrc}
        title={this.props.name}
        alt={this.props.name}
      />);
    } else {
      item = (<Overlay
        imgClass={imgClass}
        name={this.props.name}
        author={this.props.author}
        icon={icon}
        format={format}
        genre={this.props.genre}
      />);
    }

    return (
      <a href={this.props.target} className={`${this.props.linkClass} ${imgClass}`}>
        {item}
      </a>
    );
  }
}

BookCover.propTypes = {
  id: React.PropTypes.number,
  name: React.PropTypes.string,
  format: React.PropTypes.string,
  imageArgument: React.PropTypes.string,
  target: React.PropTypes.string,
  linkClass: React.PropTypes.string,
  imgSrc: React.PropTypes.string,
  author: React.PropTypes.string,
  genre: React.PropTypes.string,
};

BookCover.defaultProps = {
  format: 'BOOK/TEXT',
  genre: 'Fiction',
};

// Export components
export default BookCover;
